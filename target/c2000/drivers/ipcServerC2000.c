/*
 * @file ipcClientZynq.c
 *
 * @brief Client for the inter-processor communication (IPC) library.
 */

//=============================================================================
/*-------------------------------- Includes ---------------------------------*/
//=============================================================================
#include "ipcServerC2000.h"

#include "c2000Config.h"

#include "driverlib.h"
#include "device.h"

#include "ipc/ipcServer.h"

//=============================================================================

//=============================================================================
/*-------------------------------- Prototypes -------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
static __interrupt void  ipcServerC2000Irq(void);
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*-------------------------------- Functions --------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
void ipcServerC2000Initialize(void *irqInst){

    /* Sets up IPC interrupt */
    Interrupt_register(INT_IPC_0, ipcServerC2000Irq);
    Interrupt_enable(INT_IPC_0);
}
//-----------------------------------------------------------------------------
int32_t ipcServerC2000IrqSend(void){

    HWREG(IPC_BASE + IPC_O_SET) = 1UL << C2000_CONFIG_CPU2_CPU1_FLAG;

    return 0;
}
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*----------------------------------- IRQ -----------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
static __interrupt void  ipcServerC2000Irq(void){

    HWREG(IPC_BASE + IPC_O_ACK) = 1UL << C2000_CONFIG_CPU1_CPU2_FLAG;
    HWREG(IPC_BASE + IPC_O_CLR) = 1UL << C2000_CONFIG_CPU1_CPU2_FLAG;

    ipcServerRequest();

    Interrupt_clearACKGroup(INTERRUPT_ACK_GROUP1);
}
//-----------------------------------------------------------------------------
//=============================================================================

